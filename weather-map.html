<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SA Weather</title>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
</head>
<body>

<h1 class="bg-primary text-white p-2">Weather App</h1>
<div id="weather"></div>
<br>
<label class="ml-5 mr-2" for="input">Location</label>
<input id="input">
<button class="bg-primary text-white ml-3" id="btn">Find</button>
<div id='map' style='width: 600px; height: 500px;'></div>

<script src="js/keys.js"></script>
<script src='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js'></script>
<script src="js/map-geocoder-utils.js"></script>
<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script>

<!--    INITIAL COORDINATES-->
    var coordinates = [-98.4936, 29.4241];

    mapboxgl.accessToken = MAPBOX_ACCESS_TOKEN;
    var map = new mapboxgl.Map({
        container: 'map', // ID
        style: 'mapbox://styles/mapbox/dark-v10',
        center: coordinates, // [lng, lat]
        zoom: 9
    });

    // CREATES MARKER
    var marker = new mapboxgl.Marker({
        color: 'red',
    })
        .setLngLat([-98.4936, 29.4241])
        .setDraggable(true)
        .addTo(map);

    // FLY TO NEW LOCATION AND RESET MARKER
    $('#btn').click(function () {
        var userInput = $('#input').val();
        geocode(userInput, MAPBOX_ACCESS_TOKEN).then(function (info){
            console.log(info);
            var newCenter = {
                lng: info[0],
                lat: info[1]
            };
            map.flyTo({center: newCenter});
            marker = new mapboxgl.Marker({
                color: 'red',
            })
                .setLngLat([-74.0445, 40.6892])
                .setDraggable(true)
                .addTo(map);
                marker.setLngLat(newCenter);
        });
    });

//    GET OPEN WEATHER DATA AND FEED INTO SITE
$.get("http://api.openweathermap.org/data/2.5/onecall", {
    APPID: OPEN_WEATHER_APPID,
    lat:    29.423017,
    lon:   -98.48527,
    units: "imperial"
}).done(function(data) {
    console.log('current weather', data);

    // forEach(function (data) {
        var today = data.daily[0];
        var todayDate = new Date(today.dt * 1000).toLocaleString();

        var description = today.weather[0].description;
        var humidity = today.humidity;
        var wind = today.wind_speed
        var pressure = today.pressure

        var temps = today.temp;
        console.log(temps)

        $('#weather').html(todayDate
            + '<br>' + 'Description: ' + description
            + '<br>' + 'Humidity: ' + humidity
            + '<br>' + 'Wind: ' + wind
            + '<br>' + 'Pressure: ' + pressure)
    // });
});

</script>
</body>
</html>